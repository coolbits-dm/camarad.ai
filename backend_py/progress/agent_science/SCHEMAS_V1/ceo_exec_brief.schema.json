{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "ceo_exec_brief.schema.json",
  "title": "CEO Executive Brief",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "agent",
    "policy_used",
    "why_deep",
    "tool_context_present",
    "tool_context_used",
    "insights",
    "decision",
    "rationale",
    "risks",
    "next_actions"
  ],
  "properties": {
    "agent": {
      "type": "string",
      "const": "ceo"
    },
    "policy_used": {
      "type": "string",
      "enum": ["auto", "eco", "deep"]
    },
    "why_deep": {
      "type": ["string", "null"],
      "minLength": 1
    },
    "tool_context_present": {
      "type": "boolean"
    },
    "tool_context_used": {
      "type": "boolean"
    },
    "insights": {
      "type": "array",
      "minItems": 1,
      "maxItems": 12,
      "items": {
        "type": "string",
        "maxLength": 220
      }
    },
    "decision": {
      "type": "string",
      "enum": ["approve", "reject", "escalate", "hold"]
    },
    "rationale": {
      "type": "string",
      "minLength": 1,
      "maxLength": 360
    },
    "risks": {
      "type": "array",
      "minItems": 0,
      "maxItems": 8,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["risk", "severity", "mitigation"],
        "properties": {
          "risk": {
            "type": "string",
            "maxLength": 180
          },
          "severity": {
            "type": "string",
            "enum": ["low", "medium", "high", "critical"]
          },
          "mitigation": {
            "type": "string",
            "maxLength": 200
          }
        }
      }
    },
    "next_actions": {
      "type": "array",
      "minItems": 1,
      "maxItems": 5,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["owner", "action", "deadline_hint", "priority"],
        "properties": {
          "owner": {
            "type": "string",
            "maxLength": 60
          },
          "action": {
            "type": "string",
            "maxLength": 200
          },
          "deadline_hint": {
            "type": "string",
            "maxLength": 60
          },
          "priority": {
            "type": "string",
            "enum": ["high", "medium", "low"]
          }
        }
      }
    },
    "trace": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "request_id": {
          "type": "string",
          "maxLength": 120
        },
        "tool_calls": {
          "type": "integer",
          "minimum": 0
        },
        "estimated_ct_cost": {
          "type": "number",
          "minimum": 0
        }
      }
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "policy_used": {
            "const": "deep"
          }
        }
      },
      "then": {
        "properties": {
          "why_deep": {
            "type": "string",
            "minLength": 3
          }
        }
      }
    },
    {
      "if": {
        "properties": {
          "tool_context_present": {
            "const": true
          }
        }
      },
      "then": {
        "properties": {
          "tool_context_used": {
            "const": true
          }
        }
      }
    }
  ]
}
