# Status Snapshot - 2026-02-11

## Executive Summary

Migrarea edge production este finalizata pentru:
- `camarad.ai`
- `www.camarad.ai`
- `api.camarad.ai`

Traficul public este pe noul origin `185.146.87.91` (Nginx -> `127.0.0.1:5051`), cu Cloudflare proxy activ.

## Ce este online acum

- PM2 procese:
  - `camarad`: online (Gunicorn, 4 workers gevent)
  - `coolbits`: online (neatins)
- SSL:
  - certificat valid pentru `api.camarad.ai`
  - certificate valide pentru `camarad.ai` / `www.camarad.ai`
- Nginx:
  - vhost dedicat pentru `api.camarad.ai`
  - proxy functional catre backend Camarad
- health checks:
  - `/healthz` si `/readyz` active local/public
- backups:
  - script: `/opt/camarad/scripts/backup.sh`
  - storage local: `/opt/camarad/backups`
  - timer: `camarad-backup.timer` (daily 03:00, persistent)
  - remote optional: `rsync` sau `s3 sync` via `/opt/camarad/.env.backup`

## Validari cheie trecute

- `curl -I https://api.camarad.ai/` -> `HTTP/2 200`
- `curl -I https://api.camarad.ai/orchestrator` -> `HTTP/2 200`
- `curl -I https://api.camarad.ai/connectors` -> `HTTP/2 200`
- `curl -I https://api.camarad.ai/settings` -> `HTTP/2 200`
- nu mai apare `x-powered-by: Express` pe `api.camarad.ai` dupa cleanup.

## Incidente rezolvate in timpul migrarii

- Proxied mode trimitea catre backend vechi (Express/404)
  - cauza: Worker Route `api.camarad.ai/*` legat de `camarad-worker`
  - actiune: route sters
  - rezultat: traficul proxied merge pe origin nou

## Risc rezidual

- Scan-uri automate externe produc 404/500 pe rute inexistente (`/_next`, `/rsc`, etc.).
- Acest zgomot poate ascunde erorile reale in loguri daca nu separam logging-ul.
- Mitigare aplicata:
  - noise filter Nginx pentru rute de scan uzuale (`/_next`, `/rsc`, `/graphql`, `/server-status`, `/v2/_catalog`)
  - favicon/apple-touch-icon probes returnate direct din Nginx fara a ajunge la app

## Decizii luate

- Slug-ul default personal ramane `life-coach` pentru compatibilitate.
- Branding UI: afisat ca `Personal Assistant`.
- Strategia conectori Google: gateway catre Coolbits (rapid, low-risk).

## Urmatorul obiectiv imediat

M1 - Reliability Hardening:
- gunicorn runtime (done)
- health endpoints (done)
- log cleanup
- backup automat

## Update operational suplimentar

- Backup remote:
  - status: amanat temporar
  - motiv: Acronis activ pe VPS curent + lipsa credentiale VPS secundar in sesiunea curenta
  - impact: backup local + Acronis acopera riscul imediat; remote sync se activeaza cand sunt disponibile credentialele

- Focus urmator:
  - M2.A - Google Ads real via Coolbits gateway (feature-flagged, fallback mock)
  - M1.B - Signup/OAuth real + onboarding real user (elimina fallback mock user-id)

## Progres M2.A (start implementare)

- Endpoint-uri Google Ads actualizate:
  - `/api/connectors/google-ads/accounts`
  - `/api/connectors/google-ads/campaigns`
  - `/api/connectors/google-ads/keywords`
  - `/api/connectors/google-ads/metrics`
- Comportament nou:
  - daca `COOLBITS_GATEWAY_ENABLED=true`: incearca apel Coolbits pe path-uri compatibile
  - daca gateway nu raspunde sau payload-ul nu e utilizabil: fallback automat la mock (fara regresie UI)
- Validare:
  - sintaxa backend (`py_compile`) OK
  - test local cu Flask test client: `200` + `source=mock` in mod normal
  - test local cu gateway failure simulat: fallback mock activ, fara crash
  - path-urile canonice Coolbits au fost identificate din codul serviciului: `/api/connectors/googleads/customers` si `/api/connectors/googleads/report`
  - mapare noua adaugata pentru `campaigns`, `keywords`, `metrics(series)` din payload-ul `report` catre formatul Camarad
  - smoke test live pe server: gateway este ON, dar Coolbits returneaza `not_connected` pentru user/workspace curent => fallback mock activ (comportament asteptat)

## Progres M1.B (Signup/OAuth + onboarding real)

- Implementat auth real in Camarad folosind Coolbits OAuth:
  - pagina publica `/signup` (popup Google OAuth via Coolbits)
  - endpoint backend `/api/auth/session` (verifica token cu `/api/auth/me`, provisioneaza user local)
  - endpoint-uri `/api/auth/status`, `/api/auth/logout`, `/api/auth/onboarding`
- Onboarding real:
  - pagina `/onboarding` + API `POST /api/auth/onboarding`
  - salveaza profilul userului + default workspace
  - marcheaza explicit `preferences.onboarding_completed=true`
  - optional creeaza client company din onboarding
- Access gate:
  - paginile private (`/app`, `/chat`, `/workspace`, `/connectors`, `/agents`, `/orchestrator`, `/boardroom`, `/settings`) cer sesiune autentificata
  - userii noi sunt redirectionati obligatoriu la onboarding inainte de app
