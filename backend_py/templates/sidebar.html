<!-- templates/sidebar.html -->
<nav id="sidebar" class="sidebar bg-dark border-end border-secondary d-flex flex-column p-3">
  <div class="d-flex align-items-center mb-3" style="gap:10px;">
    <img src="/static/brand/camarad-logo-32.png" alt="Camarad logo" width="32" height="32" style="border-radius:8px;object-fit:contain;">
    <h4 class="mb-0 text-white" style="font-weight:700;letter-spacing:-0.01em;line-height:1;">Camarad<span style="color:#00a35c;">.</span>AI</h4>
  </div>
  <div class="sidebar-scroll">

  <div class="mb-3">
    <div class="dropdown">
      <button class="btn btn-outline-secondary w-100 text-start dropdown-toggle" type="button" data-bs-toggle="dropdown">
        <i class="bi bi-grid me-2"></i> Workspaces
      </button>
      <ul class="dropdown-menu bg-dark border-secondary">
        <li><a class="dropdown-item text-light" href="/workspace/personal">Personal</a></li>
        <li><a class="dropdown-item text-light" href="/workspace/business">Business</a></li>
        <li><a class="dropdown-item text-light" href="/workspace/agency">Agency</a></li>
        <li><a class="dropdown-item text-light" href="/workspace/development">Development</a></li>
      </ul>
    </div>
  </div>

  <ul class="nav flex-column mb-auto">
    <li class="nav-item">
      <a class="nav-link text-light {% if request.path == '/chat' or request.path == '/chat/' or request.path.startswith('/chat/') %}active bg-primary{% endif %}" href="/chat" title="Go to chat home">
        <i class="bi bi-chat-dots me-2"></i> Chat
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-light {% if 'connectors' in request.path %}active bg-primary{% endif %}" href="/connectors">
        <i class="bi bi-plug me-2"></i> Connectors
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-light {% if 'agents' in request.path %}active bg-primary{% endif %}" href="/agents">
        <i class="bi bi-robot me-2"></i> Agents
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-light {% if request.path == '/orchestrator' %}active bg-primary{% endif %}" href="/orchestrator">
        <i class="bi bi-diagram-3 me-2"></i> Orchestrator
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-light {% if 'boardroom' in request.path %}active bg-primary{% endif %}" href="/boardroom">
        <i class="bi bi-people-fill me-2"></i> Boardroom
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-light {% if request.path == '/settings' %}active bg-primary{% endif %}" href="/settings">
        <i class="bi bi-sliders me-2"></i> Settings
      </a>
    </li>
    <!-- Adaugă restul după nevoie -->
  </ul>

  <div class="mt-auto">
    <!-- Chats Header -->
    <div class="d-flex align-items-center justify-content-between mb-2">
      <h6 class="text-muted mb-0"><i class="bi bi-chat-left-text me-1"></i> Recent Chats</h6>
      <div class="d-flex gap-1">
        <button class="btn btn-sm btn-outline-primary" onclick="openSidebarNewChatModal()" title="Start new chat">
          <i class="bi bi-plus-lg"></i>
        </button>
        <button class="btn btn-sm btn-outline-secondary position-relative" onclick="toggleNotifPanel()" title="Notifications">
          <i class="bi bi-bell"></i>
          <span id="notif-badge" style="display:none">0</span>
        </button>
      </div>
    </div>

    <!-- Multi-chat list (loaded from /api/conversations) -->
    <div id="sidebar-chat-list" class="list-group list-group-flush mb-2" style="max-height:240px;overflow-y:auto;margin:0 -8px;">
      <p class="text-muted small px-2">Loading chats...</p>
    </div>

    <!-- New Chat Modal -->
    <div class="modal fade" id="sidebarNewChatModal" tabindex="-1" aria-labelledby="sidebarNewChatModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content bg-dark text-light border-secondary">
          <div class="modal-header border-secondary">
            <h5 class="modal-title" id="sidebarNewChatModalLabel"><i class="bi bi-chat-left-text me-2"></i>New Chat</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="sidebarNewChatWorkspace" class="form-label">Workspace</label>
              <select class="form-select bg-dark text-light border-secondary" id="sidebarNewChatWorkspace">
                <option value="personal">Personal</option>
                <option value="business">Business</option>
                <option value="agency">Agency</option>
                <option value="development">Development</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="sidebarNewChatAgent" class="form-label">Agent</label>
              <select class="form-select bg-dark text-light border-secondary" id="sidebarNewChatAgent"></select>
            </div>
            <div class="mb-0">
              <label for="sidebarNewChatTitle" class="form-label">Title</label>
              <input type="text" class="form-control bg-dark text-light border-secondary" id="sidebarNewChatTitle" placeholder="New Chat">
            </div>
          </div>
          <div class="modal-footer border-secondary">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="createSidebarNewChat()"><i class="bi bi-check2 me-1"></i>Create</button>
          </div>
        </div>
      </div>
    </div>

    <hr class="border-secondary my-2">

    <!-- Client Switcher -->
    <div class="mb-3">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <small class="text-muted">Client</small>
        <div class="d-flex gap-1">
          <button class="btn btn-sm btn-outline-info py-0 px-2" type="button" onclick="openActiveClientDetailsFromSidebar()" title="Open client details">
            <i class="bi bi-layout-sidebar-inset-reverse"></i>
          </button>
          <button class="btn btn-sm btn-outline-primary py-0 px-2" type="button" onclick="openNewClientModal()" title="Create client">
            <i class="bi bi-plus-lg"></i>
          </button>
        </div>
      </div>
      <div class="dropdown">
        <button class="btn btn-outline-secondary w-100 text-start dropdown-toggle" type="button" data-bs-toggle="dropdown" id="currentClientBtn">
          <i class="bi bi-buildings me-2"></i><span id="currentClientLabel">None</span>
        </button>
        <ul class="dropdown-menu bg-dark border-secondary w-100" id="clientDropdown">
          <li><a class="dropdown-item text-light" href="#" onclick="switchClient(null, 'None'); return false;">None</a></li>
        </ul>
      </div>
    </div>

    <div class="mb-3">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <small class="text-muted">Connected Accounts</small>
        <button class="btn btn-sm btn-outline-secondary py-0 px-2" type="button" onclick="openAddClientAccountModal()" title="Link account">
          <i class="bi bi-plus-lg"></i>
        </button>
      </div>
      <div id="clientAccountsList" class="list-group list-group-flush" style="max-height:140px;overflow-y:auto;margin:0 -8px;">
        <div class="text-muted small px-2 py-1">No client selected</div>
      </div>
    </div>

    <!-- New Client Modal -->
    <div class="modal fade" id="newClientModal" tabindex="-1" aria-labelledby="newClientModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-light border-secondary">
          <div class="modal-header border-secondary">
            <h5 class="modal-title" id="newClientModalLabel"><i class="bi bi-person-plus me-2"></i>New Client</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="clientType" class="form-label">Type</label>
              <select class="form-select bg-dark text-light border-secondary" id="clientType" onchange="toggleClientTypeFields()">
                <option value="person">Person</option>
                <option value="company">Company</option>
              </select>
            </div>
            <div class="mb-3" id="clientNameWrap">
              <label for="clientName" class="form-label">Name</label>
              <input type="text" class="form-control bg-dark text-light border-secondary" id="clientName" placeholder="John Doe">
            </div>
            <div class="mb-3" id="clientCompanyWrap" style="display:none;">
              <label for="clientCompanyName" class="form-label">Company Name</label>
              <input type="text" class="form-control bg-dark text-light border-secondary" id="clientCompanyName" placeholder="TechStart Agency">
            </div>
            <div class="mb-3">
              <label for="clientEmail" class="form-label">Email</label>
              <input type="email" class="form-control bg-dark text-light border-secondary" id="clientEmail" placeholder="contact@example.com">
            </div>
            <div class="mb-3">
              <label for="clientWebsite" class="form-label">Website</label>
              <input type="text" class="form-control bg-dark text-light border-secondary" id="clientWebsite" placeholder="https://example.com">
            </div>
            <div class="mb-0">
              <label for="clientNotes" class="form-label">Notes</label>
              <textarea class="form-control bg-dark text-light border-secondary" id="clientNotes" rows="2" placeholder="Optional notes"></textarea>
            </div>
          </div>
          <div class="modal-footer border-secondary">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="createClient()"><i class="bi bi-check2 me-1"></i>Create</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Client Account Modal -->
    <div class="modal fade" id="addClientAccountModal" tabindex="-1" aria-labelledby="addClientAccountModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-light border-secondary">
          <div class="modal-header border-secondary">
            <h5 class="modal-title" id="addClientAccountModalLabel"><i class="bi bi-link-45deg me-2"></i>Add Account</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="clientAccountConnector" class="form-label">Connector</label>
              <select class="form-select bg-dark text-light border-secondary" id="clientAccountConnector" onchange="loadMockAccountsForSelectedConnector()"></select>
            </div>
            <div class="mb-3">
              <label for="clientAccountOption" class="form-label">Account</label>
              <select class="form-select bg-dark text-light border-secondary" id="clientAccountOption"></select>
            </div>
            <div class="mb-0">
              <label for="clientAccountStatus" class="form-label">Status</label>
              <select class="form-select bg-dark text-light border-secondary" id="clientAccountStatus">
                <option value="pending" selected>Pending</option>
                <option value="connected">Connected</option>
                <option value="error">Error</option>
                <option value="disconnected">Disconnected</option>
              </select>
            </div>
          </div>
          <div class="modal-footer border-secondary">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="createClientAccountLink()"><i class="bi bi-check2 me-1"></i>Save</button>
          </div>
        </div>
      </div>
    </div>

  </div>
  </div>
  <div class="sidebar-footer-dock" aria-live="polite">
    <div class="dropup">
      <button class="btn btn-sm btn-outline-info dropdown-toggle user-chip-btn" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="userSnapshotBtn">
        <span id="userSnapshotAvatar" class="user-chip-avatar">D</span>
        <span id="userSnapshotName" class="user-chip-name">dev</span>
        <span id="userSnapshotCT" class="badge bg-secondary user-chip-ct">-- CT</span>
      </button>
      <ul class="dropdown-menu bg-dark border-secondary shadow">
        <li class="px-3 py-2 small text-muted user-chip-meta" id="userSnapshotMeta">Loading snapshot...</li>
        <li><hr class="dropdown-divider border-secondary"></li>
        <li><a class="dropdown-item text-light" href="/settings"><i class="bi bi-sliders me-2"></i>Settings & Usage</a></li>
        <li><a class="dropdown-item text-light" href="/settings#settings-billing"><i class="bi bi-credit-card-2-front me-2"></i>Billing & Subscriptions</a></li>
        <li><a class="dropdown-item text-light" href="/pricing"><i class="bi bi-tags me-2"></i>Pricing</a></li>
        <li><a class="dropdown-item text-light" href="#" onclick="if(window.loadUserSnapshot){window.loadUserSnapshot(true);} return false;"><i class="bi bi-arrow-repeat me-2"></i>Refresh Snapshot</a></li>
        <li><hr class="dropdown-divider border-secondary"></li>
        <li><a class="dropdown-item text-danger" href="#" onclick="if(window.logoutCurrentUser){window.logoutCurrentUser();} return false;"><i class="bi bi-box-arrow-right me-2"></i>Log out</a></li>
      </ul>
    </div>
  </div>
</nav>





